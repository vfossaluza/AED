--- 
title: "Análise Exploratória de Dados"
author: "Gabriela Scarpini e Victor Fossaluza"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
# url: your book url like https://bookdown.org/yihui/bookdown
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  This is a minimal example of using the bookdown package to write a book.
  The HTML output format for this example is bookdown::gitbook,
  set in the _output.yml file.
link-citations: yes
github-repo: rstudio/bookdown-demo
always_allow_html: true
---

```{r Config, include=FALSE, echo=FALSE, }
knitr::opts_chunk$set(echo=TRUE, fig.align = 'center', cache=TRUE)
require(tidyverse)
require(kableExtra)
require(dplyr)
require(webshot)
```


# Introdução {#intro}

## Apresentação

Esse material está em fase inicial de desenvolvimento e será utilizado para apoiar as aulas de MAE0111 - Análise Exploratória de Dados. 

O objetivo principal da apostila é funcionar como um resumo e auxiliar os estudantes na compreensão dos conceitos teóricos, com capítulos curtos e por meio de exercícios ao final de cada capítulo.

Comentários e correções podem ser enviadas para [gabi.scarpini@usp.br](gabi.scarpini@usp.br).

---

## Programa

1. A profissão de Estatística. A Estatística como metodologia de todas as ciências experimentais. O mercado de trabalho. O perfil profissional do Estatístico. A Estatística acadêmica: pós-graduação e pesquisa.
2. Apresentação de problemas reais analisados no CEA – Centro de Estatística Aplicada da USP, com ênfase na análise descritiva dos dados. Conclusões dos estudos.
3. Estatística descritiva e inferência estatística, tipos de dados, bancos de dados, ordem de grandeza, precisão e arredondamento de dados quantitativos, proporções e porcentagens, taxas e números índices, sugestões para construção e apresentação de gráficos e tabelas.
4. Representação gráfica e tabular da distribuição de dados: tabelas de frequências, gráficos de barras e do tipo “torta”, histogramas, densidade suavizada e função de distribuição empírica.
5. Medidas-resumo: medidas de posição, de dispersão, de assimetria e curtose, gráficos do tipo boxplot.
6. Modelos para distribuições de frequências: gráficos de probabilidade.
7. Associação entre variáveis qualitativas: tabelas de contingência de dupla entrada, coeficientes de associação, sensibilidade e especificidade, risco relativo, razão de chances, tabelas de contingência de múltiplas entradas.
8. Associação entre variáveis quantitativas: gráficos de dispersão, covariância, correlação linear, matriz de covariâncias, matriz de correlações.
9. Associação entre uma variável quantitativa e uma variável qualitativa: homogeneidade de distribuições, gráficos de médias, gráficos de perfis.
10. Outros tópicos: elaboração de relatórios técnicos, uso do aplicativo R, dashboards.

---

## Bibliografia

- Damiani, A., Milz, B., Lente, C., Falbel, D., Correa, F., Trecenti, J., Luduvice, N., Lacerda, T., Amorim, W. Ciência de Dados em R, Curso-R [link](https://livro.curso-r.com/)

- Peng, R.D. Exploratory Data Analysis with R, Leanpub. [link](https://bookdown.org/rdpeng/exdata/)

- Mayer, F.P, Bonat, W.H., Zeviani, W.M., Krainski, E.T., Ribeiro Jr, P.J. Estatística Computacional com R. [link](http://cursos.leg.ufpr.br/ecr/index.html)

- Grolemund, G. Wickham, H. R for Data Science. [link](https://r4ds.hadley.nz/) (versão em português: [link](https://pt.r4ds.hadley.nz/))

- Chang, W. R Graphics Cookbook, 2nd edition. [link](Chang, W. R Graphics Cookbook, 2nd edition.)

- Grolemund, G. Hands-On Programming with R. [link](https://jjallaire.github.io/hopr/)

---

## Bibliografia Jupiterweb

- Morettin, P. A., Bussab, W. O. (2017). Estatística Básica. 9a edição. Saraiva Educação SA.

- Wickham, H., Grolemund, G. (2017). R for data science: import, tidy, transform, visualize, and model data, O’Reilly Media, Inc. [link](https://r4ds.hadley.nz/)

- Tukey,J. W. (1977). Exploratory Data Analysis. Reading: Addison Wesley.

- Cairo, A. (2016). The truthful art: Data, charts, and maps for communication. New Riders.

- Tufte, E. R. (1983). The Visual Display of Quantitative Information, Cheshire: Graphics Press.

- Few, S. (2012). Show Me the Numbers: Designing Tables and Graphs to Enlighten, 2a ed. Analytics Press.

---

## Bibliografia Complementar

- Relatórios do CEA – Centro de Estatística Aplicada – USP.

- Magalhães, M. N, de Lima, A. C. P. (2015). Noções de Probabilidade e Estatística. 7a edição. Editora da Universidade de São Paulo.

- Murteira, B. F. J., Black, G. H. J.. (1983). Análise Exploratória de Dados - Estatística Descritiva, Lisboa: McGraw Hill.

- Wexler, S., Shaffer, J., & Cotgreave, A. (2017). The big book of dashboards: visualizing your data using real-world business scenarios. John Wiley & Sons.

- ChambersJ. M., ClevelandW. S., Tukey, P. A.. (1983). Graphical Methods for Data Analysis. Boston: Duxbury Press.

- W. M. Cleveland. (1993). Visualizing Data, Summit, New Jersey: Hobart Press.

- W. M. Cleveland. (1994). The Elements of Graphing Data, Summit: Hobart Press.

<!-- ```{r include=FALSE} -->
<!-- # automatically create a bib database for R packages -->
<!-- knitr::write_bib(c( -->
<!--   .packages(), 'bookdown', 'knitr', 'rmarkdown' -->
<!-- ), 'packages.bib') -->
<!-- ``` -->

---



<!--chapter:end:index.Rmd-->

# Conceitos básicos de Análise Exploratória de Dados {#conceitos_aed1}

## O que significa algo ser "aleatório"?

- **Aleatório** *(Google - Oxford Languages)*  
*(adjetivo)*  
1. que depende das circunstâncias, do acaso; casual, fortuito, contingente.  
2. (física) referente a fenômenos físicos para os quais as variáveis tomam valores segundo uma determinada lei de probabilidade (p.ex., o movimento browniano).  


- **Experimento Aleatório** *(The Concise Encyclopedia of Statistics,  pp 430–433)*

Um experimento em que o resultado não é previsível com antecedência é chamado de experimento aleatório. Um experimento aleatório pode ser caracterizado da seguinte forma:  
1. É possível descrever o conjunto de todos os resultados possíveis (chamado espaço amostral do experimento aleatório).  
2. Não é possível prever o resultado com certeza.  
3. É possível associar cada resultado possível a uma probabilidade de ocorrência.

---

## O que é Probabilidade?

- **Probabilidade** *(Google - Oxford Languages)*  
*(substantivo feminino)*  
1. perspectiva favorável de que algo venha a ocorrer; possibilidade, chance.
"há pouca probabilidade de chuva"  
2. grau de segurança com que se pode esperar a realização de um evento, determinado pela frequência relativa dos eventos do mesmo tipo numa série de tentativas. 

- **Probabilidade** *(The Concise Encyclopedia of Statistics,  pp 430–433)*  

Podemos definir a probabilidade de um evento usando as frequências relativas ou por meio de uma abordagem axiomática.

Na primeira abordagem, supomos que um experimento aleatório é repetido muitas vezes nas mesmas condições. Para cada evento $A$ definido no espaço amostral $\Omega$, definimos $n_A$ como o número de vezes que o evento $A$ ocorreu durante as primeiras $n$ repetições do experimento. Neste caso, a probabilidade do evento $A$, denotada por $P(A)$, é definido por:
$$P(A) = \lim_{n\rightarrow\infty} \frac{n_A}{n}~,$$

o que significa que $P(A)$ é definido como o limite relativo ao número de vezes que o evento $A$ ocorreu relativo ao número total de repetições.

Na segunda abordagem, para cada evento $A$, aceitamos que existe uma probabilidade de $A$, $P(A)$, satisfazendo os três axiomas a seguir:  
1. $0\leq P(A)\leq 1$,  
2. $P(\Omega)=1$,  
3. Para cada sequência de eventos mutuamente exclusivos $A_1,A_2,\ldots$ (isto é, eventos tais que $A_i \cap A_j = \emptyset$ se $i \neq j$):
$$ P\left(\bigcup_{i=1}^{\infty} A_i\right) = \sum_{i=1}^{\infty} P(Ai)~.$$
---

### Interpretações de Probabilidade

+ **Interpretação Clássica** (De Moivre, Laplace)
    + baseia-se na equiprobabilidade dos resultados;
    + $P(A) = \frac{|A|}{|\Omega|}$.
    + **Exemplo:** um lançamento de moeda, $A$ = "cara", $P(A) = \frac{1}{2}$.

$~$ 

+ **Interpretação Frequentista** (Venn, von Mises, Reichenbach, etc.)
    + quase unânime na primeira metade do século XX e ainda é a mais aceita;
    + baseia-se na regularidade das frequências relativas (lei dos grandes números);
    + $P(A) = lim \frac{A_n}{n}$, onde $A_n$ é o número de ocorrências de $A$ em $n$ realizações *idênticas e independentes* do experimento;
    + Supõe que é possível repetir indefinidamente o experimento nas mesmas circustâncias.
    + **Exemplo:** um lançamento de moeda, $A$ = "cara".
    
```{r LGN, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(gganimate)
set.seed(666)
N=170
p=0.6
if (knitr::is_latex_output()) {
  tibble(n=seq(1,N),b=rbinom(N,1,p),Pn=cumsum(b)/n) %>%
    ggplot( aes(x=n, y=Pn) ) +
    geom_line() + geom_point() +
    ggtitle("Convergência da Frequência Relativa") +
    ylab(expression(paste(P[n](A)," = Freq. Relativa de Caras"))) +
    geom_hline(aes(yintercept=p),color="red")
} else {
probfreq = tibble(n=seq(1,N),b=rbinom(N,1,p),Pn=cumsum(b)/n) %>%
    ggplot( aes(x=n, y=Pn) ) +
    geom_line() + geom_point() +
    ggtitle("Convergência da Frequência Relativa") +
    ylab(expression(paste(P[n](A)," = Freq. Relativa de Caras"))) +
    geom_hline(aes(yintercept=p),color="red") +
    gganimate::transition_reveal(n)
gganimate::animate(probfreq)
}
#gganimate::anim_save("./figure/ProbFreq.gif", animation = probfreqgif)
#do.call(file.remove,list(list.files(".",pattern="^gganim.+.png$")))
#print(probfreq)
```


$~$ 

 + **Interpretação Lógica** (Keynes, Jeffreys, Carnap, etc.) 
     + medida de "vínculo parcial" entre uma evidência e uma hipótese; 
     + baseia-se em relações objetivas entre proposições. 
     + **Exemplo:** considere duas proposições: "até agora todos os lançamentos resultaram em cara" e "será realizado um novo lançamento". Pode-se afirmar que "provavelmente o resultado do novo lançamento será cara". 

<!-- $~$  -->

+ **Interpretação Subjetivista** (Ramsey, de Finetti, Savage, etc)
    + probabilidade como medida subjetiva de crença;
    + baseada na experiência de cada indivíduo, portanto única.
    + **Exemplo:** suponha que Bruno lançou uma moeda 3 vezes e todos os resultados foram cara. Esse indivíduo, em posse dessa informação, pode acreditar que o resultado cara é mais provável que coroa. Contudo, quando pergunta sobre a probabilidade de cara ao seu colega Olavo, ignorante com relação a moeda, ele responde que é 1/2.  
    
---

### Comentários sobre Probabilidade e Aleatoriedade

- Exemplo da moeda. Aleatoriedade é uma característica (física) do lançamento da moeda?    

- Exemplo das bolas na Urna. A "aleatoriedade" está em "chacoalhar" a urna? E se eu "embrulhar" as bolas e colocá-las em fila sobre a mesa? O experimento ainda é "aleatório"? Qual a "probabilidade" de selecionar uma bola verde?  

---

## O que é Estatística?

- **Estatística** *(Google - Oxford Languages)*  
*(substantivo feminino)*  
1. ramo da matemática que trata da coleta, da análise, da interpretação e da apresentação de massas de dados numéricos.  
2. qualquer coleta de dados quantitativos.  

- **Estatística** *(The Concise Encyclopedia of Statistics,  pp 518–520)*  

A palavra estatística, derivada do latim, refere-se à noção de estado (status): “que é relativo ao estado”. Os governos têm uma grande necessidade de contar e medir numerosos eventos e atividades, como mudanças demográficas, nascimentos, tendências de imigração e emigração, mudanças nas taxas de emprego, negócios, etc.

Nessa perspectiva, o termo “estatística” é usado para indicar um conjunto de dados disponíveis sobre um determinado fenômeno (por exemplo, estatísticas de desemprego).

No sentido mais moderno e preciso da palavra, “estatística” é considerada uma disciplina que se preocupa com dados quantitativos. É constituído por um conjunto de técnicas de obtenção de conhecimento a partir de dados incompletos, de um rigoroso sistema científico de gestão de coleta de dados, da sua organização, análise e interpretação, quando é possível apresentá-los de forma numérica.

Numa população de indivíduos, pode ser de interesse saber, em termos de teoria estatística, se um determinado indivíduo tem carro ou se fuma. Por outro lado, também pode ser de interesse saber quantos indivíduos têm automóvel e são fumantes, e se existe relação entre possuir automóvel e hábitos de tabagismo na população estudada.

Gostaríamos de conhecer as características da população globalmente, sem nos preocuparmos com cada pessoa ou cada objeto da população.

Distinguimos dois subconjuntos de técnicas: (1) aquelas que envolvem estatísticas descritivas e (2) aquelas que envolvem estatísticas inferenciais. O objetivo essencial da estatística descritiva é representar a informação em um formato compreensível e útil. A estatística inferencial, por outro lado, visa facilitar a generalização dessas informações ou, mais especificamente, fazer inferências (relativas a populações) com base em amostras dessas populações.


- **Estatístico** *(segundo prof. Carlos Alberto de Bragança Pereira)*

*"The Statistician is the Wizard who makes "scientific" statements about invisible states and quantities. However, contrary to the real wishes (or witches), he attaches uncertainties to his statements."*

---

## Método Científico

1. Formulação de uma questão, teoria ou hipótese.  
2. Coleta de informações: planejamento de um experimento para obtenção de dados ou apenas a observação de um fenômeno ou variáveis de interesse.  
3. Conclusões (por vezes, parciais) baseadas nos dados obtidos anteriormente.  
4. Se necessário, repetir (2) e (3) ou formular novas hipóteses.  

---

## População X Amostra, Probabilidade X Estatística

- *População* é o conjunto de todos os elementos ou resultados possíveis.  
- *Amostra* é um subconjunto da população.  
- *Experimento* é "tornar visível o que antes era invisível", por exemplo, observar uma amostra da população.  
- *Probabilidade* é uma descrição matemática da incerteza, é bem especificada quando a população é conhecida.  
- *Estatística* estuda a distribuição de probabilidades quando esta não está bem especificada (é desconhecida, ao menos parcialmente).  

  * **Modelo Probabilístico:** $(\Omega, \mathcal{F}, \boldsymbol{P})$, onde $\Omega$ é o espaço amostral, $\mathcal{F}$ é uma coleção ($\sigma$-álgebra) de subconjuntos de omega e $\boldsymbol{P}$ é uma medida de probabilidade (conhecida, fixada)   
  * **Modelo Estatístico:** simplificadamente, um modelo estatístico é uma forma probabilística de relacionar uma quantidade desconhecida de interesse (*parâmetro*) com os dados observados.  
  * $(\Omega, \mathcal{F}, \mathcal{P})$, onde $\mathcal{P}$ é uma família de distribuições de probabilidade. Na estatística, o objetivo é fazer afirmações sobre essa família.  

---

## Estatística Descritiva

- Conjunto de técnicas para visualização (redução) dos dados.  
- Análises e conclusões preliminares.  
- Fornece informações que auxiliam na especificações de um *modelo estatístico*.  
- Também utilizada para  
  * Avaliação de modelos;  
  * Interpretação de modelos complexos;  
  * Comunicação dos resultados.  

- Exemplo: medidas resumo, gráficos e tabelas.

---

## Inferência Estatística

- Generalizar resultados observados em uma amostra para a população de interesse.  
- Normalmente baseada em algumas suposições que são traduzidas em um *modelo estatístico*.  
- Principais objetivos: concluir se há relações entre variáveis, estimativas pontuais e intervalares e testes de hipóteses.  
- Como o objetivo é generalizar conclusões para a população, é usual ter uma grande preocupação com a verificação das suposições do modelo estatístico adotado.  
- Por vezes chamada de "análise confirmatória".

---

## Aprendizado Estatístico

- Similarmente à inferência estatística, estuda relação entre variáveis mas tem como objetivo fazer predições para novas observações.  
- Como o objetivo é fazer predições, o foco é obter um modelo que "acerte" mais ou, em outras palavras, que minimize algum tipo de função de perda, dando menos atenção à suposições sobre o modelo probabilístico utilizado.  
- Na prática, o conjunto de dados é dividido em um *conjunto de treinamento* e um *conjunto de teste*. O primeiro é usado para a obtenção de modelos e o segundo para a sua avaliação. O modelo escolhido é aquele que "acerta mais" no conjunto de teste.  
- Também pode ser pensada como uma forma reproduzir o mecanismo gerador dos dados. 

---

<!--chapter:end:Cap2-conceitos.Rmd-->

# Apresentação à linguagem R {#apresentacao_r}

  O R é uma linguagem de programação amplamente utilizada para análise de dados, cálculo estatísticos e visualização de dados. Além disso, o R tem uma enorme coleção de pacotes que ampliam suas funcionalidades, usaremos alguns durante o nosso estudo.
O RStudio é uma interface gráfica para a linguagem de programação R. Ele torna o R mais fácil de usar e fornece algumas funcionalidades úteis.

---

## Como instalar

  Para instalar o R e o R-Studio basta seguir as instruções [aqui](https://livro.curso-r.com/1-1-instalacao-do-r.html) e [aqui](https://livro.curso-r.com/1-2-instalacao-do-rstudio.html)

---

## Comparação com outras linguagens estatísticas

Diferente de outras linguagens de programação, o R foi desenvolvido especificamente para a área de estatística, sendo usado na análise de dados e modelagem. Por isso, essa linguagem possui uma enorme quantidade de pacotes voltados para visualização e análise de dados (alguns exemplos são o ggplot2, dplyr, caret).

---

## Introdução ao RMarkdown

Na disciplina de Análise Exploratória de Dados, usaremos somente o RMarkdown, uma ferramenta que nos permite escrever textos e executar códigos em R.

Para criar um arquivo em RMarrkdown clique em *File > New File > R Markdown*. Preencha as informações iniciais, como o título do documento e o autor e por fim escolha o tipo de saída, como PDF, HTML ou Word. 

- **Estrutura de um Arquivo RMarkdown**

Um arquivo .Rmd tem a seguinte estrutura:

1. Cabeçalho YAML, que define as configurações do documento.
```{r yaml, eval = FALSE}
title: "Introdução ao RMarkdown"
author: "Seu Nome"
date: "18/03/2025"
output: html_document
```

2. Texto formatado, que usa a sintaxe Markdown para formatação de texto, por exemplo:
  - "# Título 1" para criar títulos de nível 1.
  - Para destacar: '*'*Texto em itálico*'*' ou '**'**Texto em negrito**'**'.
  - Para criar listas não ordenadas (com marcadores): use - ou * antes dos itens. Já para listas ordenadas (numeradas): use números seguidos de ponto.
  
3. Blocos de códigos (chunks), que são delimitados por três crases (```) e é onde você pode escrever e executar os comandos em R. Eles permitem integrar o código diretamente ao documento, gerando tabelas, gráficos, etc. 
Para cria-lo basta escrever as três crases 
Um atalho para cria-lo é com CTRL+ALT+I.

```{r, nome_do_chunk}
# seu código R.
```

- **Equações Matemáticas no RMarkdown:**

É possível fazer equações matemáticas em R Markdown usando a sintaxe do LaTeX. Existem duas formas principais:

1. Equações em linha: use cifrões simples `$...$` para inserir fórmulas no meio do texto.
2. Equações destacadas (em bloco): use dois cifrões `$$...$$` para centralizar a equação.


Para mais informações sobre o R Markdown, acesse a cheatsheet oficial diretamente pelo RStudio.
Basta ir em Help > Cheatsheets > R Markdown Cheat Sheet.
Lá você encontra um resumo com os principais comandos de formatação, código, tabelas, gráficos e equações.

---

## Operadores Básicos

- **Operadores de atribuição:**

Em R usamos os operadores de atribuição para atribuir valores a variáveis. Para fazer isso podemos usar <-, -> e =.

```{r atribuição}
a <- 5 # armazena o valor 5 dentro da variável "a"
a

10 -> b # armazena o valor 10 dentro da variável "b"
b

c = 7 # armazena o valor 7 dentro da variável "c"
c
```

Mesmo sendo possível usar diferentes operadores de atribuição, o padrão costuma ser feito com <-. Para isso, podemos usar o atalho ALT+-.

---

- **Operadores aritméticos:**

Para realizar operações matemáticas básicas, usamos:

```{r operações}
# Adição: "+"
resultado1 <- 7 + 3

# Subtração: "-"
resultado2 <- 50 - 5

# Multiplicação: "*"
resultado3 <- 6 * 7  # 42

# Divisão: "/"
resultado4 <- 17 / 3

# Exponenciação: "^" ou "**"
resultado5 <- 2 ^ 4 
resultado6 <- 3 ** 2

# Resto da divisão: "%%"
resultado7 <- 10 %% 3 

# Divisão inteira: "%/%"
resultado8 <- 10 %/% 3
```

---

- **Operadores de comparação:**

Usamos os operadores de comparação para comparar dois valores, sendo retorado um valor lógico: TRUE ou FALSE, dependendo do resultado da comparação.

```{r comparação}
# Igualdade: "=="
3 == 3 # retorna TRUE
3 == 4 # retorna FALSE

# Desigualdade: "!="
8 != 7 # retorna TRUE
9 != 9 # retorna FALSE

# Maior que: ">"
7 > 3 # retorna TRUE

# Menor que: "<"
7 < 3 # retorna FALSE

# Maior ou igual: ">="
8 >= 10 # retorna FALSE

# Menor ou igua: "<="
9 <= 9 # retorna TRUE
```

---

- **Valores especiais**

Os valores especiais são usados para representar situações atípicas ou condições especiais nos dados, como valores ausentes, infinitos ou indefinidos.

1. NA (Not Available): O valor NA representa dados ausentes ou não disponíveis.

```{r NA}
a <- NA

b <- c(1, 2, 3)
b[4] # valor fora dos límites de um vetor também é NA

# Verifica se o valor é NA
is.na(a)
is.na(b)

```

2. NaN (Not a Number): um tipo especial de NA, usado para representar resultados indefinidos de operações matemáticas, como divisões por zero.

```{r NaN}
c <- 0/0
d <- log(-1)

# Verifica se o valor é NaN
is.nan(c)
is.nan(d)
```

3. Inf e -Inf (Infinito): Inf e -Inf representam valores infinitos. 

```{r inf}
f <- 2 / 0
g <- -1 / 0  

# Verifica se o valor é Inf
is.infinite(f)  
```

4. NULL: representa a ausência de um valor ou objeto. Diferente do NA, que representa um valor ausente dentro do de um vetor ou lista, NULL indica que o objeto não existe.
Usamos normalmente para iniciar variáveis ou para remover elementos de listas.

```{r null}
h <- NULL

# Verifica se o valor é null
is.null(h)
```

---

## Estrutura de Dados em R

- **Vetores**

Os vetores são uma estrutura de dados que armazena uma sequência de elementos, sendo todos do mesmo tipo (número, caracteres ou valores lógicos).

- Vetor numérico:

```{r vetor_númerico}
n <- c(11, 22, 33, 44)

n[2] # Valor no índice 2 do vetor

# Valor do vetor em um subconjunto de índices
n[c(1,3)]
n[c(3,1,4,2)]
n[1:3] # valores do vetor do índice 1 ao índice 3

# Multiplicação por escalar (multiplica cada elemento)
2*n

# Soma com escalar (soma cada elemento)
v <- n+1

# Soma de Vetores (soma cada termo de n com o elemento de mesmo índice de v)
n+v

# Produto de Vetores (termo a termo)
n*v

# Produto Escalar (multiplica os dois vetores da mesma posição e soma os resultados dessas multiplicações)
n%*%v

# Quando somamos vetores de tamanhos diferentes repetimos os elementos até o tamanho do maior
n - c(1,2)

# Caso o tamanho de um deles naõ seja multiplo do outro, o R solta uma mensagem de erro
c(1,2,3) - n
```

- Vetor de Caracteres:

```{r vetor_caractere}
Nomes = c("Letícia","Mariana","Guilherme","Viviane",
          "Ana","Otávio","Eduardo")


# Identificando o tipo de vetor
typeof(Nomes)
class(Nomes)
```

- Vetor de valores lógicos:

```{r}
Feminino = c(TRUE,TRUE,FALSE,TRUE, TRUE, FALSE, FALSE)

# Identificando o tipo de vetor
class(Feminino)

# TRUE e FALSE são tratados como 1 e 0
sum(Feminino)
```

---

- **Matrizes** 

Matrizes é uma estrutura de dados que permite armazenar os dados de uma forma bidimensional, com linhas e colunas. Todos os elementos precisam ser do mesmo tipo.

```{r matrizes}
M <- matrix(c(1, 0, 0, 2, 1, 0, 3, 4, 1), ncol=3)

# Dimensção da Matriz M
dim(M) # linha, coluna

# Acessando um elemento da matriz
M[1, 2] # elemento da linha 1 e da coluna 2
M[1,] # primeira linha (vetor)
M[,3] # última coluna (vetor)

# Determinante
det(M)

# Matriz Inversa
IM <- solve(M)

# Produto de Matrizes
M%*%IM
```

---

- **Listas**

Diferente dos vetores, as listas podem armazenar objetos de tipos diferentes, sendo muito mais flexíveis. 

```{r listas}
lista <- list(
  nome = "Letícia",
  notas = c(8, 10, 9, 7, 6, 8),
  matriz = matrix(1:4, nrow = 2)
)

# Acessando elementos de uma lista
lista[[3]] # usando o índice
lista$notas # usando o nome
lista[c("nome", "notas")]

# Modificando elementos
lista$notas <- c(8, 9)
```

---

- **Fatores**

No R, a estrutura de dados fatores podem ser usadas para representar os dados categóricos, ou seja, variáveis que assumem valores diferentes, como níveis, podendo ser ordenados ou não.

```{r fatores}
nivel_educacional <- factor(c("Fundamental", "Médio", "Superior"))

satisfacao <- factor(c("baixa", "alta", "média"),
                     levels = c("baixa", "média", "alta"), # indica os níveis
                     ordered = TRUE) # indica que a ordem dos níveis importa
```

Para trabalhar com fatores podemos usar o pacote forcats, que nos fornece funções para criar, modificar e organizar fatores de forma eficiente, sendo possível reordenar níveis com base em valores associados, agrupar categorias raras, ordenar níveis com base em suas frequências e trabalhar com dados categóricos de forma mais eficaz. Ainda nesse capítulo, falaremos mais sobre a instalação e o uso de pacotes dentro do RMarkdown.

---

- **Data Frames**

Os Data Frames são uma das estruturas mais usadas para armazenar os dados em formato de tabela.
Cada coluna é um vetor de mesmo tamanho e pode ter tipos diferentes (números, caracteres, fatores, etc.).

```{r data_frames}
df <- data.frame(
  nome = c("Mariana", "Juliana", "Isabela"),
  idade = c(19, 8, 14),
  altura = c(1.68, 1.50, 1.55)
)

# Acessando colunas
df$nome

# Acessando elementos usando colchetes - o primeiro indíce refere-se as linhas e o segundo a # as colunas
df[, "idade"]  
df[1, ]        
df[1, "altura"] 

```

Por mais que possa parecer com a estrutura de listas, o data frame é uma tabela de dados em formato de linhas e colunas. Diferente de uma lista, as suas colunas devem ter o mesmo número de elementos.

Também podemos manipular os data frames no R usando banco de dados.

```{r data_frame_banco}
# Carregando o banco de dados 'iris'
data("iris")

# Vendo o conteúdo do banco de dados
# iris # tudo
head(iris) # primeiros elementos
tail(iris) # últimos elementos

# Dimensões do banco de bados
dim(iris) # primeiro as linhas, depois as colunas
nrow(iris) # número de linhas
ncol(iris) # número de colunas

# Nome das variáveis (colunas)
names(iris)
colnames(iris)

# Nome das variáveis (linhas)
rownames(iris)
```

---

## Estruturas de controle

As estruturas de controles são "instruções" que nos permiter criar lógica nos programas e determinar como as operações e funções serão excecutadas. 


- **Condicionais**

As estruturas condicionais permitem executar blocos de código com base em condições lógicas. Elas verificam se determinada condição é verdadeira ou falsa e excecutam diferentes blocos do código com base no resultado.

O comando *if* avalia se uma condição é verdadeira (TRUE), caso seja o bloco de código associado é excecutado.

```{r if}
# if (condição) {
  # Código executado se a condição for TRUE
# }

# Exemplo
a <- 10
if (a > 5) {
  print("a é maior que 5")
}
```

Quando é necessário tratar tanto o caso que a condição é verdadeira, quanto o caso em que é falsa, utilizamos *if - else*.

```{r if-else}
# if (condição) {
  # Código executado se a condição for TRUE
# } else {
  # Código executado se a condição for FALSE
# }

# Exemplo

b <- 3
if (b > 5) {
  print("b é maior que 5")
} else {
  print("b é menor ou igual a 5")
}
```

Quando temos mais de uma condição usamos *if - else if - else*. 

```{r if-elseif-else}
# if (condição1) {
  # Código executado se condição1 for TRUE
# } else if (condição2) {
  # Código executado se condição1 for falsa e condição2 for TRUE
# } else {
  # Código executado se nenhuma das condições anteriores for TRUE
# }

# Exemplo
c <- 0
if (c > 0) {
  print("c é positivo")
} else if (c < 0) {
  print("c é negativo")
} else {
  print("c é zero")
}
```

Quando se trata de analisar vetores, podemos usar *ifelse*, que avalia cada elemento de vetor de maneira individual.

```{r ifelse}
# ifelse(condição, valor_se_verdadeiro, valor_se_falso)

# Exemplo
d <- c(-5, 0, 4, 9)
resposta <- ifelse(d > 0, "positivo", "não positivo")
print(resposta)
```

---

- **Laços de repetição**

Os laços de repetição (ou loops) em R nos permitem executar blocos de códigos múltipla vezes. Temos dois principais tipos: *for* e *while*.

O *for* é um laço de iteração, usado para iterar sobre uma sequência, como vetores, listas, etc. 

```{r for}
# for (variável in sequência) {
  # Código a ser executado
# }

# Exemplo
for (i in 1:5) { 
  print(paste("O quadrado de", i, "é", i^2))
}
```

No exemplo acima a variável "i" assume o valor de cada número da sequência em cada iteração, ou seja, i assume a sequência de números de 1 a 5.

O *while* é um laço condicional, ou seja, executa o bloco de código enquanto a condição determinada for verdadeira.

```{r while}
# while (condição) {
  # Código a ser executado
# }

# Exemplo
a <- 1
while (a <= 5) {
  print(a)
  a <- a + 1
}
```

O exemplo acima realiza uma contagem de 1 até 5. O valor da variável "a" começa em 1, a condição a <= 5 é verificada e enquanto ela for verdadeira o código dentro do laço é executado. A cada iteração o valor de x é impresso e incrementado 1. O loop finaliza assim que a se torna 6, ou seja, o momento em que a condição x<= 5 se torna falsa.

É preciso tomar cuidado para que o *while* não se torne um loop infinito, ou seja, é necessário garantir que a condição imposta no *while* se torne falsa em algum momento.

---

## Funções

As funções são blocos de código reutilizáveis que nos permitem executar tarefas específicas.
A estrutura básica de uma função é:
  - Nome da função;
  - Argumentos (entrada que a função espera receber);
  - Corpo da função (especifica o que a função faz);
  - Valor de retorno (o que a função retorna após a execução).
  
```{r soma}
soma <- function(a, b){
  resultado <- a + b
  return(resultado)
  }

# Testando a função 'soma'
soma(7, 3)
```

Podemos criar funções utilizando estruturas de controle, para determinar o fluxo de execução do código.

```{r fatorial}
# Função que calcula o fatorial de um inteiro não negativo
fatorial <- function(n){
  if(n<0){
    print("Número negativo! Digite um inteiro positivo!")
    return()
  }
  f <- 1
  while(n>1){
    f <- f*n
    n <- n-1
  }
  return(f)
}

# Testa a função 'fatorial'
fatorial(4)
# Teste para um número negativo
fatorial(-1)
```

Podemos criar também função com valores padrões, atribuindo valores aos argumentos. Dessa forma, se o usuário não fornecer um valor ao chamar a função, o valor padrão é utilizado.

```{r arg_padrao}
subtracao <- function(a, b = 1) {
  resultado <- a - b
  return(resultado)
}

# Testando a função 'subtracao'
subtracao(7, 2) # com os dois argumentos
subtracao(5) # usando o argumento padrão para "b"
```

---

## Funções Básicas e Pacotes

As funções básicas são aquelas já incorporadas na linguagem, que não requerem pacotes adicionais. Alguns exemplos são:
- 'mean()' para calcular a média de um vetor
- 'sd()' para o desvio padrão.
- 'sum()' para somar os elementos de um vetor.
- 'prod()' – Multiplica todos os elementos de um vetor.

Já os pacotes são coleções de funções que estendem a funcionalidade do R, permitindo a realização de análises mais específicas. Os pacotes que usaremos nessa apostila são: ggplot2, dplyr, tdyr, forcats, tibble

Pacotes podem ser instalados usando `install.packages("nome_do_pacote")` e carregados com `library(nome_do_pacote)`.

---

## Exercícios

1) Crie dois vetores de números inteiros: vetor1 e vetor2, ambos com a mesma quantidade de elementos. Depois realize as seguintes operações:
  a. some os dois vetores.
  b. subtraia o vetor 1 do vetor2.
  c. multiplique os dois vetores, elemento por elemento.

2) Crie duas matrizes de dimensões 3x3. Depois realize as seguintes operações:
  a. some as duas matrizes.
  b. subtraia a segunda matriz da primeira.
  c. multiplique as duas matrizes.

3. Crie um data.frame chamado alunos com três colunas: Nome, Idade e Nota. Preencha o data.frame com pelo menos 5 registros. Em seguida,  crie uma nova coluna chamada Aprovado, que será TRUE se a Nota for maior ou igual a 5 e FALSE caso contrário.

4) Escreva uma função que retorna uma matriz "E" em que cada elemento é o valor "b" elevado a cada elemento da matriz M. Como padrão, b=e.

5) Escreva uma função que recebe dois parâmetros: base e altura, e retorna a área de um triângulo.

6) Escreva uma que recebe um vetor de números e retorna uma lista com a quantidade de números positivos e a quantidade de números negativos no vetor.

---

<!--chapter:end:Cap3-R.Rmd-->

# Dados {#dados_4}

## Processos de obtenção, importação, organização e transformação

- **Obtenção**: experimentos controlados, estudos observacionais, etc.
- **Importação**: armazenar (ou importar) os dados em um formato compatível com software utilizado, aqui utilizaremos o R.
- **Organização**: colocar os dados em uma estrutura consistente. Normalmente, cada linha é a uma observação e cada coluna é uma variável.
- **Transformação**: criar novas variáveis como função das variáveis existentes, restringir observações de interesse, calcular medidas resumo, etc.


```{r dados_pixar, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
require(kableExtra)
require(tibble)
require(tidyverse)  
filmes_pixar <- read.csv("./arquivos/filmes_pixar.csv")


pixar_dados <- tibble(ordem_lancamento = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10),
                      filme = c("Toy Story", "Vida de inseto", "Toy Story 2", 
                          "Monstros S. A.", "Procurando Nemo", "Os Incríveis", 
                          "Carros", "Ratatouille", "WALL-E", "Up Altas Aventuras"),
                      data_lancamento = as.Date(c("1995-11-22", "1998-11-25", "1999-11-24", 
                             "2001-11-02", "2003-05-30", "2004-11-05", 
                             "2006-06-09", "2007-06-29", "2008-06-27", 
                             "2009-05-29")),
                      duracao = c(81, 95, 92, 92, 100, 115, 117, 111, 98, 96),
                      bilheteria_mundial_mi = c(373, 363, 497, 632, 871, 631, 
                                             461, 623, 521, 735),
                      genero = c("Aventura", "Comédia", "Aventura", "Aventura", 
                            "Comédia", "Ação", "Esporte", "Aventura", 
                            "Ficção Científica", "Drama"))

pixar_dados <- pixar_dados %>%  
  rename('Ordem Lançamento' = ordem_lancamento, 'Filme' = filme ,
         'Data' = data_lancamento, 'Duração' = duracao, 
          'Bilheteria (Milhões)' = bilheteria_mundial_mi, 'Gênero' = genero)

pixar_dados %>% 
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
     bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) 
      c("striped", "hold_position", "scale_down") else NULL,
    font_size = if (knitr::is_latex_output()) 8 else 15
  ) %>% 
  row_spec(0, bold = TRUE, 
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")
```

A tabela acima é uma versão reduzida do banco de dados "filmes_pixar", disponível para download **[aqui](./arquivos/filmes_pixar.csv)**. 
Este banco de dados foi elaborado para servir de base na construção de tabelas e gráficos nesse e nos próximos capítulos. Já a versão reduzida será usada para facilitar os cálculos e a resolução de exemplos na lousa, durante a aula.

---

## Tipos de Variáveis 

1. **Qualitativas:** atributos não numéricos
   - *Nominal*   
     * Nomes ou rótulos, sem uma relação de ordem   
     * Exemplos: Sexo, Religião, Cor dos Olhos, Time de Futebol  
   - *Ordinal*   
     * As diferentes categorias podem ser colocados em ordem   
     * Exemplos: Faixa Etária, Escolaridade, Classe Social  

2. **Quantitativas:** atributos numéricos   
   - *Discretas*   
     * Assume uma quantidade enumerável de valores   
     * Exemplos: Número de Filhos, Quantidade de Erros na Prova, Número de Livros Lidos em 2023 
   - *Contínuas*  
     * Assume uma quantidade não enumerável de valores   
     * Exemplos: Altura, Pressão, Tempo  

---

## Tabelas de Frequências

- Tabela contendo frequências absolutas e/ou relativas de cada categoria de uma *variável qualitativa*. 

```{r tab_indicativa, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
require(dplyr)

tab_genero <- filmes_pixar %>% 
         group_by(genero) %>% 
         summarise(Freq = n()) %>% 
         mutate(FreqRel = round(Freq/sum(Freq), 3)) %>% 
         rename(Gênero = genero)

tab_genero %>% 
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
    bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) c("striped", "hold_position") 
    else NULL) %>% 
  row_spec(0, bold = TRUE,
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")
```

Pode-se afirmar que nesta amostra, o gênero predominante é aventura (34,7% dos filmes).

- Para *variáveis qualitativas ordinais*, pode-se também considerar as frequências relativas acumuladas. 

- Também é possível fazer tabela de frequências para *variáveis quantitativas discretas*. Para algumas variáveis, como a duração do filme, poucos valores se repetem. Nesses casos, é comum agrupar os valores dessas variáveis em classes e calcular a frequência de cada classe. 

```{r tab_duracao, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
tab_duracao <- filmes_pixar %>%
        mutate(Faixas_duração = factor(
          case_when(duracao <= 90  ~ "80 |-- 90", duracao <= 100 ~ "90 |-- 100",
          duracao <= 110 ~ "101 |-- 110", TRUE          ~ "111 |-- 120"),
          levels = c("80 |-- 90", "90 |-- 100", "101 |-- 110", "111 |-- 120"), 
          ordered = TRUE)) %>%
        group_by(Faixas_duração) %>%
        summarise(Freq = n()) %>%
        mutate(FreqRel = round(Freq / sum(Freq), 3)) %>%
        arrange(Faixas_duração)

tab_duracao %>% 
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
    bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) c("striped", "hold_position") 
    else NULL) %>% 
  row_spec(0, bold = TRUE, 
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")
```

- Por fim, para *variáveis quantitativas contínuas*, também podemos usar  

```{r tab_bilheteria, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
tab_bilheteria <- filmes_pixar %>%
        mutate(Bilheteria_Mundial = ifelse(bilheteria_mundial <= 500000000, 
              "300 milhões |-- 500 milhões", ifelse(bilheteria_mundial <= 700000000,                              "500 milhões |-- 700 milhões", ifelse(bilheteria_mundial <= 900000000, 
              "700 milhões |-- 900 milhões", ifelse(bilheteria_mundial <= 1100000000, 
              "900 milhões |-- 1.1 bilhão", "1.1 bilhão |-- 1.3 bilhão"))))) %>%
        group_by(Bilheteria_Mundial) %>% 
        summarise(Freq = n()) %>% 
        mutate(FreqRel = Freq / sum(Freq),  
              FreqRel = round(FreqRel, 3),  
              FreqAcum = cumsum(FreqRel)) %>%
        mutate(FreqAcum = ifelse(row_number() == n(), 1, FreqAcum)) 

tab_bilheteria %>% 
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
    bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) c("striped", "hold_position") 
    else NULL) %>% 
  row_spec(0, bold = TRUE, 
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")  
``` 

- A quantidade e o tamanho das faixas é arbitrário. Contudo, um número muito pequeno de classes pode ocasionar perda de informação, enquanto um número muito grande de classes pode prejudicar o objetivo de resumir os dados.  

- Por fim, as faixas podem ter tamanhos diferentes. No entanto, a análise dessas classes deve ser feito com cuidado. A escolha de classes com tamanhos diferentes normalmente só é feita quando há poucas observações em algum intervalo. 

---

<!--chapter:end:Cap4-Dados.Rmd-->

# Medidas de uma variável {#medidas_uma_variavel_5}


## Medidas de posição ou de Tendência Central

- Utilidadas para resumir variáveis quantitativas.  
- Dão a ideia do lugar da reta estão concentrados os valores de uma variável. 


### Média (Aritmética)

- A medida mais utilizada é a **média**, definida por $$\displaystyle \bar{x} = \frac{1}{n}\sum_{i=1}^n x_i = \dfrac{x_1+x_2+\ldots+x_n}{n}~.$$  
  *Exemplo - Duração dos filmes da pixar: $\bar{x} = \frac{81+95+92+92+100+115+117+111+98+96+103+106+93+104+95+93+97+102+105+118+100+102+100}{23}=100.65$

- Alternativamente, quando há empates (isto é, $n_1$ observações do valor $x_1$, $n_2$ observações do valor $x_2$, e assim por diante), podemos calcular a média por $$\displaystyle \bar{x} = \frac{1}{n}\sum_{i=1}^k n_i~x_i = \sum_{i=1}^k f_i~x_i = \frac{n_1~x_1+n_2~x_2+\ldots+n_k~x_k}{n}~,$$ em que $k\leq n$ é a quantidade de valores diferentes assumidos pela variável $X$ e $\sum n_i = n$. Ainda pode-se considerar para o cálculo da média a frequência relativa $f_i = n_i/n$.  

- Quando os dados estão agrupados em classes, podemos calcular um valor aproximado da média fazendo $$\displaystyle \bar{x} \approx \sum_{i=1}^k f_i~\bar{x}_i~,$$ em que $\bar{x}_i$ é o valor médio da *i*-ésima classe e $f_i$ é a frequência relativa daquela classe.  

### Mediana 

- A **mediana** é o valor central dos dados. Pode ser calculada por 

$$
\displaystyle md(x) = 
\left\{
  \begin{array}{ll}
    x_{\left(\frac{n+1}{2}\right)} ,&  ~\text{se } n \text{ é ímpar} \\ 
    \dfrac{x_{\left(\frac{n}{2}\right)}+x_{\left(\frac{n}{2}+1\right)}}{2} ,&  ~\text{se } n \text{ é par}
  \end{array}
\right.
$$

em que $x_{(1)}\leq x_{(2)}\leq \ldots \leq x_{(n)}$, $x_{(1)}$ é o menor valor observado na amostra, $x_{(2)}$ é o segundo menor valor, $\ldots$, $x_{(n)}$ é o maior valor na amostra. $x_{(1)}, x_{(2)}, \ldots, x_{(n)}$ são chamados *estatísticas de ordem*.  
  * Para a duração do filme: $md(x) = 1.725$
  
- **Observação:** a mediana é uma medida mais robusta que a média pois é menos afetada por valores extremos.


### Moda 

- A **moda** é o valor que mais frequente na amostra.  
- Em alguns casos, pode existir mais de uma moda.  
  * Para a duração do filme: $mo(x) = 100$
  
---

## Medidas de Dispersão

- Na maioria dos casos, somente as medidas de posição trazem pouca informação sobre a variável de interesse.  
- Por exemplo, considere as seguintes amostras de tamanho 3: $(1,5,9)$, $(4,5,6)$ e $(5,5,5)$. Em todas elas, $\bar{x}=md(x)=5$. Contudo, na primeira os valores estão mais "espalhados", enquanto na última os valores estão mais "concentrados".  
- Para descrever melhor esta diferença, podemos usar medidas que nos informem o quanto os dados estão "espalhados", ou como é a dispersão dos dados.  

###	Variância

- A variância é a média dos desvios ao quadrado das observações com relação à média,  dada por $$var(x) = \frac{1}{n}\sum_{i=1}^n \left(x_i - \bar{x}\right)^2.$$  
  * No exemplo acima:  
    1. para a Amostra 1: $\dfrac{(1-5)^2+(5-5)^2+(9-5)^2}{3}=\dfrac{16+0+16}{3}=10.666$;
    2. para a Amostra 2: $\dfrac{(4-5)^2+(5-5)^2+(6-5)^2}{3}=\dfrac{1+0+1}{3}=0.666$;
    3. para a Amostra 3: $\dfrac{(5-5)^2+(5-5)^2+(5-5)^2}{3}=0$.
  * No exemplo da duração do filme: $var(x) = 73$

###	Desvio padrão

- A variância está em uma escala diferente da variável observada. Uma forma de contornar isso é calcular sua raiz. A medida resultante é chamada de desvio padrão: $dp(x) = \sqrt{var(x)}$     
  * No exemplo acima:  
    1. para a Amostra 1: $\sqrt{\dfrac{(1-5)^2+(5-5)^2+(9-5)^2}{3}}=\sqrt{32/3}=3.265986$;
    2. para a Amostra 2: $\sqrt{\dfrac{(4-5)^2+(5-5)^2+(6-5)^2}{3}}=\sqrt{2/3}=0.8164966$;
    3. para a Amostra 3: $\sqrt{\dfrac{(5-5)^2+(5-5)^2+(5-5)^2}{3}}=0$.
  * No exemplo da duração do filme: $dp(x) = \sqrt{73}=8.54~m$

###	Desvio médio ou absoluto

- Outra medida de dispersão é o desvio médio (ou absoluto): $$dm(x) = \frac{1}{n}\sum_{i=1}^n \left|x_i - \bar{x}\right|.$$     
  * No exemplo acima:  
    1. para a Amostra 1: ${\dfrac{|1-5|+|5-5|+|9-5|}{3}}=\dfrac{8}{3} \approx 2.666$;
    2. para a Amostra 2: ${\dfrac{|4-5|+|5-5|+|6-5|}{3}}=\dfrac{2}{3} \approx 0.666$;
    3. para a Amostra 3: ${\dfrac{|5-5|+|5-5|+|5-5|}{3}}=0$.

- O desvio médio, assim como o desvio padrão, representam "erros" médios ao aproximar os valores observados pela média.

---

## Medidas de ordem

###	Quartis e quantis

- Como vimos, a mediana é o valor que "divide ao meio" a amostra.  
- De forma similar, podemos dividir a amostra em partes menores. Por exemplo, pode ser de interesse considerar os valores que dividem a amostra nos 5% menores valores, 10% menores, 20% e assim por diante.  
- O *quantil* de ordem *p* ou *p*-quantil, $0 < p < 1$, é o valor $Q(p)$ tal que $100\cdot p~\%$ das
observações sejam menores do que $Q(p)$.

- Há diversas formas de definir os quantis amostrais (veja, por exemplo, a ajuda do R para a função *quantile*). Aqui, por simplicidade, vamos considerar a definição a seguir. 
$$
Q(p) =
\left\{
  \begin{array}{lll}
    x_{(i)} & \text{se} & p = p_i = \frac{i - 0.5}{n}, \quad i = 1, \ldots, n \\
    (1 - f_i) Q(p_i) + f_i Q(p_{i+1}) & \text{se} & p_i < p < p_{i+1} \\
    x_{(1)} & \text{se} & 0 < p < p_1 \\
    x_{(n)} & \text{se} & p_n < p < 1
  \end{array}
\right.
$$

          em que $f_i = \dfrac{p-p_i}{p_{i+1}-p_i}$.

- Quando houver empates (valores iguais) na amostra, vamos considerar o maior $p_i$ entre as observações empatadas.
          
- Outros quantis podem ser calculados, como por exemplo,  
  * $Q(0.5) = \left(1-\frac{0.5-0.45}{0.55-0.45}\right)Q(0.45)+\left(\frac{0.5-0.45}{0.55-0.45}\right)Q(0.55)=\frac{1}{2}\cdot 1.70 + \frac{1}{2}\cdot 1.75 = 1.725 = md(x)$
  * $Q(0.83) = \left(1-\frac{0.83-0.75}{0.85-0.75}\right)Q(0.75)+\left(\frac{0.83-0.75}{0.85-0.75}\right)Q(0.85)=0.2\cdot 1.79 + 0.8\cdot 1.81 = 1.806$
  * $Q(0.13) = \left(1-\frac{0.13-0.05}{0.25-0.05}\right)Q(0.05)+\left(\frac{0.13-0.05}{0.25-0.05}\right)Q(0.25)=0.6\cdot 1.50 + 0.4\cdot 1.60 = 1.54$
  
- Os quantis $Q(0.25)$, $Q(0.50)$ e $Q(0.75)$ são chamados de primeiro, segundo e terceiro **quartis** e são denotados por $q_1$, $q_2$ e $q_3$, respectivamente. Como já foi dito, $q_2 = md(x)$.  

###	Distância (ou Amplitude) Interquartis

- Outra medida de dispersão bastante utilizada é a *distância interquartis*, definida por $$d_Q = q_3 - q_1~.$$
- A distância interquartis é a amplitude do intervalo que concentra 50% das observações centrais.  

### Desvio Mediano Absoluto
          
- Como a mediana é uma medida mais robusta que a média, é possível estabelecer também uma medida de dispersão em termos de desvios em relação à mediana. Assim, defina o *desvio mediano absoluto* como $$dma(x) = md(|x_i - md(x)|)~.$$  

### Amplitude

- Distância entre o maior e o menos valor observado.
$$\Delta = x_{(n)} - x_{(1)}$$
  
---

## Medidas de assimetria 

```{r assimetria_duracao, echo = FALSE, include = TRUE}
require(ggplot2)

hist <- filmes_pixar %>% 
  ggplot() + theme_classic() + xlab("") +
  ggtitle("Duração dos filmes da Pixar") +
  geom_histogram(aes(duracao,after_stat(density)), 
                 color="black", fill="deeppink", bins=5)

box <- filmes_pixar %>% 
  ggplot(aes(x="",y=duracao)) + theme_classic() + coord_flip() + 
  xlab("") + ylab("") + 
  geom_boxplot(color="black", fill="deeppink")  

simA <- ggpubr::ggarrange(hist, box, heights = c(2, 1), nrow=2, align = "v")
```

```{r assimetria_bilheteria, echo = FALSE, include = TRUE}
hist <- filmes_pixar %>% 
  ggplot() + theme_classic() + xlab("") + 
  ggtitle("Bilheteria Mundial dos filmes da Pixar") +
  geom_histogram(aes(bilheteria_mundial,after_stat(density)), 
                 color="black", fill="deeppink", bins=5)

box <- filmes_pixar %>% 
  ggplot(aes(x="",y=bilheteria_mundial)) + theme_classic() + coord_flip() + 
  xlab("") + ylab("") + 
  geom_boxplot(color="black", fill="deeppink")  

simB <- ggpubr::ggarrange(hist, box, heights = c(2, 1), nrow=2, align = "v")
```

###	Coeficiente de Assimetria de Bowley

$$B = \frac{(q_3-q_2)-(q_2-q_1)}{q_3-q_1} = \frac{(q_3-q_2)-(q_2-q_1)}{(q_3-q_2)+(q_2-q_1)} = \frac{q_3+q_1-2q_2}{q_3-q_1}$$

###	Coeficiente de Assimetria de Pearson 1

$$Sk_1 = \frac{\bar{x}-moda(x)}{\sqrt{\frac{n}{n-1}}~dp(x)}$$
  
###	Coeficiente de Assimetria de Pearson 2

$$Sk_2 = 3\cdot\frac{\bar{x}-md(x)}{\sqrt{\frac{n}{n-1}}~dp(x)}$$
  
- Considere o ***k*-ésimo momento (central) amostral**, definido por $$m_k = \frac{1}{n}\sum_{i=1}^{n}\left(x_i-\bar{x}\right)^k$$

###	Coeficiente de Assimetria de Fisher-Pearson

$$g_1 = m_3/m_2^{3/2}$$

###	Coeficiente de Assimetria de Fisher-Pearson ajustado

(pelo tamanho amostral)**:** $$g_2 = \frac{n\sqrt{n(n-1)}}{n-1}g1$$

---

## Calculo de medidas no R

- Média: função mean()

```{r media_5}
media <- mean(c(10, 20, 30, 40, 50, 55, 60))
```

- Mediana: função median()

```{r mediana_5}
mediana <- median(c(10, 20, 30, 40, 50, 68))
```

- Moda: o R não possui uma função embutida para moda, porém podemos calcular dessa forma:

```{r moda_5}
dados <- c(1, 2, 2, 3, 3, 3, 4)

frequencias <- table(dados)
moda <- as.numeric(names(frequencias[frequencias == max(frequencias)]))
```

- Quartis: função quantile()

```{r quartil_5}
quartis <- quantile(c(10, 20, 30, 40, 50))
```

- Variância: função var()

```{r var_5}
dados <- c(10, 12, 23, 23, 16, 23, 21, 16)
variancia <- var(dados)
```

- Desvio padrão: função sd()

```{r dp_5}
dados <- c(10, 12, 23, 23, 16, 23, 21, 16)
desvio_padrao <- sd(dados)
```

- Desvio mediano absoluto: função´mad()

```{r mad_5}
dados <- c(10, 12, 23, 23, 16, 23, 21, 16)
desvio_mediano_absoluto <- mad(dados)
```

---

<!--chapter:end:Cap5-Med_uma_variável.Rmd-->

# Modelos Gráficos {#modelos_graficos6}

## Gráfico de Barras

- O gráfico de barras é adequado para variáveis qualitativas (nominais ou ordinais) e também para variáveis quantitativas discretas.

```{r dados_cap6, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
require(kableExtra)
require(dplyr)

tab_genero <- filmes_pixar %>% 
      group_by(genero) %>% 
      summarise(Freq = n()) %>% 
      mutate(FreqRel = Freq/sum(Freq)) %>% 
      rename(Gênero = genero)

tab_duracao <- filmes_pixar %>%
  mutate(Faixa_duracao = cut(duracao, 
                             breaks = seq(floor(min(duracao)), ceiling(max(duracao)), by = 5), 
                             include.lowest = TRUE)) %>%
  group_by(Faixa_duracao) %>%
  summarise(Freq = n()) %>%
  mutate(FreqRel = Freq / sum(Freq)) %>%
  arrange(Faixa_duracao)


tab1_bilheteria <- filmes_pixar %>%
       mutate(Bilheteria_Mundial = ifelse(bilheteria_mundial <= 500000000, 
          "300 milhões |-- 500 milhões", ifelse(bilheteria_mundial <= 700000000,                              "500 milhões |-- 700 milhões", ifelse(bilheteria_mundial <= 900000000, 
          "700 milhões |-- 900 milhões", ifelse(bilheteria_mundial <= 1100000000, 
          "900 milhões |-- 1.1 bilhão", "1.1 bilhão |-- 1.3 bilhão"))))) %>%
        group_by(Bilheteria_Mundial) %>% 
        summarise(Freq = n()) %>% 
        mutate(FreqRel = Freq/sum(Freq),
                delta = c(0.10, 0.10, 0.10, 0.10, 0.10), Dens = FreqRel/delta)

tab2_bilheteria <- filmes_pixar %>%
        mutate(Bilheteria_Mundial = ifelse(bilheteria_mundial <= 500000000, 
            "300 milhões |-- 500 milhões", ifelse(bilheteria_mundial <= 700000000,                              "500 milhões |-- 700 milhões", ifelse(bilheteria_mundial <= 900000000, 
            "700 milhões |-- 900 milhões", ifelse(bilheteria_mundial <= 1100000000, 
            "900 milhões |-- 1.1 bilhão", "1.1 bilhão |-- 1.3 bilhão"))))) %>%
        group_by(Bilheteria_Mundial) %>% 
        summarise(Freq = n()) %>% 
        mutate(FreqRel = Freq/sum(Freq),
                delta = c(0.20, 0.10, 0.10, 0.10, 0.10), Dens = FreqRel/delta)
```

- **Exemplo 1: Variável Qualitativa Nominal** (Gênero de filme)

```{r barras_genero, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
tab_genero %>% 
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
     bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) 
      c("striped", "hold_position", "scale_down") else NULL,
    font_size = if (knitr::is_latex_output()) 8 else 15
  ) %>% 
  row_spec(0, bold = TRUE, 
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")
```

```{r graf_genero, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
graf_genero_f <- filmes_pixar %>% 
  ggplot() + theme_bw() + xlab("genero") + ylab("Freqûencia") +
  geom_bar(aes(x = genero, fill= genero)) + 
  scale_fill_manual("genero", values = c("Aventura" = "deeppink", 
                   "Comédia" = "magenta", "Ação" = "coral2", 
                   "Esporte" = "seagreen1", "Drama" = "turquoise3", 
                   "Musical" = "maroon3", "Ficção Científica" = "royalblue"))

graf_genero_p <- tab_genero %>% 
  ggplot() + theme_bw() + xlab("genero") + ylab("Proporção") +
  geom_bar(aes(x= Gênero, fill= Gênero, y=FreqRel), stat="identity") + 
  scale_fill_manual("genero", values = c("Aventura" = "deeppink", 
                    "Comédia" = "magenta", "Ação" = "coral2", 
                    "Esporte" = "seagreen1", "Drama" = "turquoise3", 
                    "Musical" = "maroon3", "Ficção Científica" = "royalblue"))

# ggpubr::ggarrange(graf_genero_f,graf_genero_p, legend="none")
ggpubr::ggarrange(graf_genero_f, graf_genero_p, legend = "none", ncol = 1)
```


- **Exemplo 2: Variável Quantitativa** (duração do filme)

```{r barras_duracao, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
tab_duracao %>%
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
     bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) 
      c("striped", "hold_position", "scale_down") else NULL,
    font_size = if (knitr::is_latex_output()) 8 else 15
  ) %>% 
  row_spec(0, bold = TRUE, 
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")
```

```{r graf_duracao, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
tab_duracao %>% 
  ggplot() + theme_bw() + xlab("Duração do filme") + ylab("Proporção") +
  geom_bar(aes(x= Faixa_duracao, y= FreqRel), fill="royalblue", stat="identity")
```

---

## Gráfico de Setores (Pizza)


- Pode ser utilizado para variáveis qualitativas.

```{r pizza1, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
pizza_genero <- tab_genero %>% 
  mutate(Porc = scales::percent(FreqRel)) %>% 
  ggplot(aes(x = "", y = FreqRel, fill = Gênero)) +
  geom_col(color = "white") + 
  geom_label(aes(label = Porc), #color = c(1, "white", "white"),
        position = position_stack(vjust = 0.5),
        show.legend = FALSE) + guides(fill = guide_legend(title = "")) +
        scale_fill_manual("Gênero dos filmes", values =c("Aventura" = "deeppink", 
                        "Comédia" = "magenta", "Ação" = "coral2", 
                        "Esporte" = "seagreen1", "Drama" = "turquoise3", 
                        "Musical" = "maroon3", "Ficção Científica" = "royalblue1")) +
  coord_polar(theta = "y") + ggtitle("Gênero dos filmes") +
  theme_void() + theme(legend.position="bottom", 
                       plot.title = element_text(hjust = 0.5))

ggpubr::ggarrange(pizza_genero)
```

- Por que deve ser evitado?  
  * Quando as frequências são muito pequenas (abaixo de 5%, por exemplo), as fatias se tornam de difícil visualização.  
  * Dependem do uso de cores. Isso pode dificultar a escolha de cores que sejam suficientemente contrastantes para uma melhor visualização. Isso pode ser ainda mais prejudicado dependendo do dispotitivo que for visualizar o gráfico (se a impressão ou o monitor for de baixa qualidade, por exemplo). Por fim, isso pode dificultar a visualização por pessoas que tem dificuldades em enxergar cores (cerca de 8% da população masculina é daltônica, por exemplo).  
  * A comparação direta entre dois gráficos de pizza é bem mais difícil que em gráficos de barras. No segundo é bem mais facil visualizar diferenças, se esse for seu objetivo.  
  * Ainda assim, podem ser utilizados em casos específicos onde os problemas anteriores não ocorrem (quando há poucas categorias, nenhuma delas com frequencias muito baixas e as diferenças são muito evidentes ou o objetivo não é fazer comparações).  
  
---

## Histograma

- Adequado para variáveis quantitativas (contínuas).  
- Apesar de ser parecido com o gráfico de barras, no histograma as bases dos retângulos são proporcionais aos intervalos das classes e as áreas de cada retângulo devem ser proporcionais às frequências de cada classe.

```{r tab_bilheteria2, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
tab1_bilheteria %>% select(Bilheteria_Mundial,Freq,FreqRel) %>% 
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
     bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) 
      c("striped", "hold_position", "scale_down") else NULL,
    font_size = if (knitr::is_latex_output()) 8 else 15
  ) %>% 
  row_spec(0, bold = TRUE, 
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")
```

```{r hist_bilheteria1, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
filmes_pixar %>% ggplot() + theme_bw() +
  geom_histogram(aes(bilheteria_mundial), color="black", fill="royalblue", 
                 breaks= c(300000000, 500000000, 700000000, 900000000, 
                           1100000000, 1300000000))
```


- Quando as faixas tem tamanhos diferentes, não é adequado usar as frequências absolutas ou relativas no eixo y pois a área do gráfico correspondente pode dar a impressão de que as frequências são maiores do que efetivamente foi observado. É possível ver isso no gráfico a seguir.  
- Neste caso, o ideal é utilizar a *densidade de frequência* no eixo y, dada por $d_i = \frac{f_i}{\delta_i}$, onde $\delta_i$ é o comprimento da faixa.

```{r tab2_bilheteria, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
tab2_bilheteria %>% 
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
     bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) 
      c("striped", "hold_position", "scale_down") else NULL,
    font_size = if (knitr::is_latex_output()) 8 else 15
  ) %>% 
  row_spec(0, bold = TRUE, 
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")
```

```{r hist_bilheteria2, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
#hist_bilheteria_c <- 
filmes_pixar %>% ggplot() + theme_bw() +
  geom_histogram(aes(bilheteria_mundial), color="black", fill="royalblue", 
                 breaks= c(300000000, 500000000, 700000000, 900000000, 
                           1100000000, 1300000000))

#hist_bilheteria_m <- 
filmes_pixar %>% ggplot() + theme_bw() +
  geom_histogram(aes(bilheteria_mundial,after_stat(density)), 
                 color="black", fill="royalblue", 
                 breaks= c(300000000, 500000000, 700000000, 900000000, 
                           1100000000, 1300000000))

#ggpubr::ggarrange(hist_bilheteria_c, hist_bilheteria_m, ncol=1)
```


- Note que desta forma, a área total do histograma é igual a 1.

### Números de faixas e largura

Para construir um histograma, não existe um número correto de faixas, e diferentes larguras podem revelar diferentes aspectos dos dados. Faixas mais largas ajudam a reduzir o ruído onde há poucos dados, enquanto faixas mais estreitas aumentam a precisão onde há muitos dados. Existem diferentes métodos para fazer essa escolha, alguns exemplos são:

**Fórmula de Sturges:**

Uma opção simples é usar a *Fórmula de Sturges*, que calcula o número de faixas a partir do tamanho da amostra:

$$
k = \lceil \log_2 n \rceil + 1
$$
Esse é o método padrão usado pelo R base. Como esse método calcula o número de faixas com base no tamanho da amostra $n$, ela pode ter um desempenho ruim quando $n < 30$, pois gera poucas faixas, o que dificulta a visualização de tendências. Para grandes conjunto de dados, ela pode superestimar a largura das faixas, gerando um histogramas execivamente suavizado. Além disso, pode não funcionar bem para dados que não seguem uma distribuição normal.

**Regra de Referência Normal de Scoot:**

Outra método é a *Regra de Referência Normal de Scott*, que busca minimizar o erro na estimativa da densidade. Ela define a largura $h$ das faixas como:

$$
h = \frac{3,49 \cdot \text{desvio padrão}}{\sqrt[3]{n}}
$$

Essa abordagem é melhor para dados com variabilidade semelhante à de uma distribuição normal.

**Regra de Freedman-Diaconis:**

Outro exemplo é a regra de Freedman–Diaconis, que é mais robusta a dados assimétricos ou com outliers, usando o intervalo interquartil (IQR) no lugar do desvio padrão, ele define a largura $h$ das faixas como:

$$
h = 2 \cdot \frac{\text{IQR}(x)}{\sqrt[3]{n}}
$$

Ela se adapta melhor a distribuições que não são tão bem comportadas.

**Exemplo no R:**

Para criar um histograma no R usando o número de faixas (ou largura das faixas) usando a fórmula desejada, é possível calcular o valor manualmente e depois passá-lo para o argumento breaks da função *hist()*.

```{r ex_sturges, eval = FALSE}
# Exemplo usando a fórmula de Sturges:
n <- length(dados)  # Tamanho da amostra
k_sturges <- 1 + log2(n)  # Fórmula de Sturges

hist(dados, breaks = k_sturges)
```

Além disso, também é possível usar um número de faixas diretamente, colocando o valor de breaks como um número inteiro.

Assim, dependendo do tipo de dado e do objetivo da análise, podemos escolher o método mais adequado para definir o número de faixas no histograma. Para encontrar outros métodos e fórmulas, basta acessar o site **[aqui](https://en.wikipedia.org/wiki/Histogram#Number_of_bins_and_width)**.

---

## Ramos e Folhas

- Similar a um histograma mas com menos perda de informação.

```{r tab_duracao_steam, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
tibble(duracao = sort(filmes_pixar$duracao)) %>%
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
     bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) 
      c("striped", "hold_position", "scale_down") else NULL,
    font_size = if (knitr::is_latex_output()) 8 else 15
  ) %>% 
  row_spec(0, bold = TRUE, 
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")
```

```{r stemleaf_duracao, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
stem(filmes_pixar$duracao)
```


```{r tab_bilheteria_steam, echo = FALSE, include = TRUE, message=FALSE, warning=FALSE}
tab1_bilheteria %>% 
  kbl(align = 'c', format = knitr::opts_knit$get("rmarkdown.pandoc.to"), 
      booktabs = TRUE) %>% 
  kable_styling(
     bootstrap_options = if (knitr::is_html_output()) c("striped","hover", 
                            "bordered", "condensed") else NULL, 
    latex_options = if (knitr::is_latex_output()) 
      c("striped", "hold_position", "scale_down") else NULL,
    font_size = if (knitr::is_latex_output()) 8 else 15
  ) %>% 
  row_spec(0, bold = TRUE, 
           color = if (knitr::is_latex_output()) "black" else "white", 
           background = if (knitr::is_latex_output()) "#D3D3D3" else "firebrick")
```

```{r stemleaf_bilheteria, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
stem(filmes_pixar$bilheteria_mundial / 1e9) 
```


- Não é adequado quando temos grandes bancos de dados e não tem o mesmo efeito visual de um boxplot.

---

## Box-Plot

- Utilizado para representar graficamente os quartis, além dos valores mínimo e máximo.  

```{r boxplot_duracao, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
filmes_pixar %>% ggplot() + theme_bw() + 
  geom_boxplot(aes(y=duracao), color="black", fill="royalblue") 
```

- No retângulo estão representados os quartis $q_1$, $q_2$ e $q_3$.  
- A reta acima do retângulo se estende até o valor máximo observado, desde que esse não seja maior que $q_3 + 1.5 \cdot d_q$.    
- Do mesmo modo, a reta abaixo do retângulo do retângulo se estende até o mínimo, desde que esse não seja menor que $q_1 - 1.5 \cdot d_q$.  
- Se houver valores que excedam os limites acima propostos, a reta acima (abaixo) do retângulo vai até o maior (menor) valor menor (maior) que $q_3 + 1.5 \cdot d_q$ $\left(q_1 - 1.5 \cdot d_q\right)$.   
- Os valores fora destes limites serão representados por asteriscos e são chamados de *outliers* (ou *valores atípicos*)  

- É possivel incluir os pontos observados no boxplot para não ter perda de informação.

```{r boxplot_P_duracao, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
filmes_pixar %>% ggplot(aes(x="",y=duracao)) + theme_bw() + 
  geom_boxplot(color="black", fill="royalblue") + 
  ggbeeswarm::geom_beeswarm(cex=3,size=3,method = "center")
  #geom_dotplot(binaxis= "y",stackdir = "center",fill = 1,dotsize = 0.8,stackratio=2)
  #geom_jitter(color="black", size=1, alpha=0.9)
```

---

## Gráficos e simetria

```{r simetria, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
set.seed(13)

simul <- tibble(y = rnorm(150,2.5,1))
lim = c(min(simul$y),max(simul$y))

hist <- simul %>% ggplot() + theme_classic() + xlab("") + xlim(lim[1],lim[2]) + 
  ggtitle("Simetria") +
  geom_histogram(aes(y,after_stat(density)), 
                 color="black", fill="royalblue", bins=8)

box <- simul %>% ggplot(aes(x="",y=y)) + 
  theme_classic() + coord_flip() + xlab("") + ylab("") + ylim(lim[1],lim[2]) +
  geom_boxplot(color="black", fill="royalblue")  
  #ggbeeswarm::geom_beeswarm(cex=1,size=1,method = "center")

ggpubr::ggarrange(hist, box, heights = c(2, 1), nrow=2, align = "v")
```

```{r assimetriaD, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
set.seed(13)

simul <- tibble(y = rgamma(150,2.5,1))
lim = c(min(simul$y),max(simul$y))

hist <- simul %>% ggplot() + theme_classic() + xlab("") + xlim(lim[1],lim[2]) +
  ggtitle("Assimetria à Direita") +
  geom_histogram(aes(y,after_stat(density)), 
                 color="black", fill="royalblue", bins=10)

box <- simul %>% ggplot(aes(x="",y=y)) + 
  theme_classic() + coord_flip() + xlab("") + ylab("") + ylim(lim[1],lim[2]) +
  geom_boxplot(color="black", fill="royalblue")  
  #ggbeeswarm::geom_beeswarm(cex=1,size=1,method = "center")

ggpubr::ggarrange(hist, box, heights = c(2, 1), nrow=2, align = "v")
```

```{r assimetriaE, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
simul <- lim[2]-simul+lim[1]
lim = c(min(simul$y),max(simul$y))

hist <- simul %>% ggplot() + theme_classic() + xlab("") + xlim(lim[1],lim[2]) +
  ggtitle("Assimetria à Esquerda") +
  geom_histogram(aes(y,after_stat(density)), 
                 color="black", fill="royalblue", bins=10)

box <- simul %>% ggplot(aes(x="",y=y)) + 
  theme_classic() + coord_flip() + xlab("") + ylab("") + ylim(lim[1],lim[2]) +
  geom_boxplot(color="black", fill="royalblue")  
  #ggbeeswarm::geom_beeswarm(cex=1,size=1,method = "center")

ggpubr::ggarrange(hist, box, heights = c(2, 1), nrow=2, align = "v")
```

- Os quartis são medidas de posição que auxiliam na avaliação da simetria dos dados. Para uma distribuição aproximadamente **simétrica**, espera-se que
  * $q_2 - x(1) ~\approx~ x(n)-q_2$ ,  
  * $q_2 - q_1 ~\approx~ q_3-q_2$ ,  
  * $q_1 - x(1) ~\approx~ x(n)-q_3$ .  

- A distribiuição dos dados é dita **assimétrica à direita** se as diferenças entre os quantis situados a direita da mediana e a mediana são maiores que as diferenças entre a mediana e os quantis situados à esquerda da mediana. Se o contrário ocorre, dizemos que a distribuição é **assimétrica à esquerda**.

- Além disso, se uma distribuição é aproximadamente simétrica,
  * $q_2-x_{(i)} ~\approx~ x_{(n+1-i)}-q_2$ , $i=1,\ldots,\lfloor(n+1)/2\rfloor$ , em que $\lfloor y \rfloor$ é o maior inteiro menor ou igual a $y$.
  
- Assim, defina $u_i = q_2-x_{(i)}$ e $v_i = x_{(n+1-i)}-q_2$, para $i=1,\ldots,\lfloor(n+1)/2\rfloor$. Então,  
  * Se a distribuição é simetrica, espera-se que $u_i \approx v_i$ ;
  * Se a distribuição é assimetrica à direira, espera-se que $u_i \leq v_i$ ; 
  * Se a distribuição é assimetrica à esquerda, espera-se que $u_i \geq v_i$.  
  
- Uma forma de fazer essa avaliação é fazer um gráfico dos pares $(u_i,v_i)$.

```{r graf_simetria, echo = TRUE, include = TRUE, message=FALSE, warning=FALSE}
tibble(u = 100.6522 - sort(filmes_pixar$duracao)[1:5],
       v = sort(filmes_pixar$duracao,decreasing=TRUE)[1:5] - 100.6522) %>% 
  ggplot() + theme_bw() + 
  geom_point(aes(x=u,y=v)) + 
  geom_line(aes(x=u,y=u))
```

---

## Exercícios

1. Escolha um banco de dados de sua preferência no R ou na internet contendo pelo menos duas variáveis quantitativas (preferencialmente contínuas). Crie um arquivo de RMarkdown e faça:
a. um histograma
b. um boxplot

---

<!--chapter:end:Cap6-Gráficos.Rmd-->

# Análise bivariada {#anaise_bi7}

- Considere que o interesse agora é estudar a relação entre variáveis. Se não há associação entre duas ou mais variáveis, dizemos que elas são independentes.


- **Exemplo:** suponha que deseja-se estudar se a cor da roupa (1: clara, 0: escura) está associado com gostar de basquete (1: sim, 0: não). Perguntei para 10 alunos da turma e os dados estão apresentados abaixo

```{r dados_cap7}
dados_cap7 <- tibble(Camisa=c(1,1,1,1,1,0,0,0,0,0),
                Basquete=c(1,0,1,0,1,0,0,0,1,0))
```

## Duas variáveis categóricas

**Tabela de Contingência (de Frequências)**

- Para variáveis categóricas, vamos primeiramente considerar tabelas de frequências.

```{r tabela_R_base6}
# R base
tab1 <- table(dados_cap7$Camisa,dados_cap7$Basquete)
tab1
```

- Lembre-se que podemos pensam em independência com relação à distribuição conjunta ou à distribuição condicional.

- Se o objetivo é estudar a distribuição conjunta, podemos considerar as frequências relativas ao tamanho total da amostra observada.

```{r tabela_gt2}
# Tidyverse
require(gtsummary)
dados_cap7 %>% tbl_cross(Camisa,Basquete,percent = "cell") %>% 
  bold_labels()
```

- Se o objetivo é estudar a distribuição condicional, podemos considerar as frequências relativas ao total das linhas ou das colunas. Pelo desenho de nosso estudo, eu fixei o total de cada cor da camisa, então a tabela abaixo é construída com relação ao total das linhas.

```{r tidyverse}
# Tidyverse com porcentagens das linhas
dados_cap7 %>% tbl_cross(Camisa,Basquete,percent = "row") %>% 
  bold_labels()
```


**Correlação amostral**

- Podemos estimar a $E[xY]$ como $\displaystyle \frac{1}{n}\sum_{i=1}^n x_i~y_i$.

- Assim, a $COV(X,Y)$ pode ser estimada por $\displaystyle cov = \frac{1}{n}\sum_{i=1}^n x_i~y_i - \bar{x}~\bar{y}$.

- Analogamente, a correção amostral é $$cor = \dfrac{cov}{\sqrt{var(x)var(y)}} = \dfrac{\displaystyle \sum_{i=1}^n x_i~y_i - n~\bar{x}~\bar{y}}{\displaystyle \sqrt{\sum_{i=1}^n (x_i-\bar{x})^2\sum_{j=1}^n(y_j-\bar{y})^2}}~.$$

- No exemplo:

```{r correlacao}
cor(dados_cap7$Camisa,dados_cap7$Basquete)
```

**Qui-Quadrado de Pearson**

- Sejam $o_{ij}$ as frequências observadas na *i*-ésima linha e *j*-ésima coluna da tabela, $o_{i.}$ o total observado na linha *i* e $o_{.j}$ o total observado na coluna *j*. Sob a hipótese de independência, espera que o valor observado em cada casela da tabela seja $\displaystyle e_{ij} = \frac{o_{i.}~o_{.j}}{n}$.

- A estatística de Qui-Quadrado é dada por:
$$Q^2 = \sum_i \sum_j \frac{(o_{ij}-e_{ij})^2}{e_{ij}}~.$$
- No exemplo: 

```{r chi2, warning=FALSE}
chi2 = chisq.test(tab1)$statistic
chi2
```

---

<!--chapter:end:Cap7-Análise_bivariada.Rmd-->

# Medidas de duas variáveis {#medidas_duas_va}

##	Tabela de Contingência (de Frequências)

- Para variáveis categóricas, vamos primeiramente considerar tabelas de frequências.

```{r tabela_R_base7}
# R base
tab1 <- table(dados_cap7$Camisa,dados_cap7$Basquete)
tab1
```

- Lembre-se que podemos pensam em independência com relação à distribuição conjunta ou à distribuição condicional.

- Se o objetivo é estudar a distribuição conjunta, podemos considerar as frequências relativas ao tamanho total da amostra observada.

```{r tab1}
# Tidyverse
require(gtsummary)
dados_cap7 %>% tbl_cross(Camisa,Basquete,percent = "cell") %>% 
  bold_labels()
```

- Se o objetivo é estudar a distribuição condicional, podemos considerar as frequências relativas ao total das linhas ou das colunas. Pelo desenho de nosso estudo, eu fixei o total de cada cor da camisa, então a tabela abaixo é construída com relação ao total das linhas.

```{r tab2}
# Tidyverse com porcentagens das linhas
dados_cap7 %>% tbl_cross(Camisa,Basquete,percent = "row") %>% 
  bold_labels()
```

##	Correlação amostral

- Podemos estimar a $E[xY]$ como $\displaystyle \frac{1}{n}\sum_{i=1}^n x_i~y_i$.

- Assim, a $COV(X,Y)$ pode ser estimada por $\displaystyle cov = \frac{1}{n}\sum_{i=1}^n x_i~y_i - \bar{x}~\bar{y}$.

- Analogamente, a correção amostral é $$cor = \dfrac{cov}{\sqrt{var(x)var(y)}} = \dfrac{\displaystyle \sum_{i=1}^n x_i~y_i - n~\bar{x}~\bar{y}}{\displaystyle \sqrt{\sum_{i=1}^n (x_i-\bar{x})^2\sum_{j=1}^n(y_j-\bar{y})^2}}~.$$

- No exemplo:

```{r cor}
cor(dados_cap7$Camisa, dados_cap7$Basquete)
```

##	Qui-Quadrado de Pearson

- Sejam $o_{ij}$ as frequências observadas na *i*-ésima linha e *j*-ésima coluna da tabela, $o_{i.}$ o total observado na linha *i* e $o_{.j}$ o total observado na coluna *j*. Sob a hipótese de independência, espera que o valor observado em cada casela da tabela seja $\displaystyle e_{ij} = \frac{o_{i.}~o_{.j}}{n}$.

- A estatística de Qui-Quadrado é dada por:
$$Q^2 = \sum_i \sum_j \frac{(o_{ij}-e_{ij})^2}{e_{ij}}~.$$
- No exemplo: 

```{r chi2_2, warning=FALSE}
chi2 = chisq.test(tab1)$statistic
chi2
```

---

##	Medidas de Associação baseadas no Qui-Quadrado

```{r dados_basq}
require(gtsummary)
dados_cap7 %>% tbl_cross(Camisa, Basquete, percent = "cell") %>%
  bold_labels()
```

###	Coeficiente de Contingência de Pearson

$$C = \sqrt{\frac{Q^2}{Q^2 + n}} \qquad 0\leq C\leq1$$

No exemplo:  
$$C = \sqrt{\frac{\frac{10}{6}}{\frac{10}{6} + 10}} = 0.791$$

O Coeficiente de Contingência de Pearson é muito influenciado pelo número de linhas (\(l\)) e número de colunas (\(c\)).

###	Coeficiente de Tcschupov

$$T = \sqrt{\frac{Q^2/n}{(l - 1) (c - 1)}} \qquad 0\leq T\leq1$$

No exemplo:

$$T = \sqrt{\frac{\frac{1.66}{10}}{(2 - 1) (2 - 1)}} = 0.41$$

---

##	Outras Medidas de Associação

- Considere um contexto em que deseja-se avalia a presença de um desfecho (ter um determinado cancer, gostar de basquete, etc) na presença de um fator de risco (fumar, usar roupa clara).

```{r tab_risco}
require(kableExtra)
tibble('Fator de Risco' = c("Não", "Sim"), 
       'Sem o Desfecho' = c("(1-q)", "(1-p)"), 
       'Com o Desfecho' = c("q", "p")) %>% 
  kbl(align = 'c', format = "html", booktabs = TRUE)%>% 
  kable_styling(
     bootstrap_options = c("striped","hover", "bordered", "condensed"), 
     latex_options = c("striped"))
```

###	Risco Atribuível

  - $RA = p - q$: é a diferença entre as probabilidades de ter a doença dado a presença do fator de risco e de ter a doença sem fator de risco.  
  - No exemplo:
  
  $$RA = 	\frac{3}{5} - {1 \over 5} = \frac{2}{5}$$
  
###	Risco Relativo

  - $RR = p/q$: é quantas vezes é mais provavél ter a doença tendo o fator de risco em relação a quem não tem.  
  - No exemplo:
  
  $$RR = \frac{3/5}{1/5} = 3  $$

###	Razão de Chances (“Odds Ratio”)

  - Os termos probabilidade e chance são sinônimos mas, por convenção, usaremos a notação $3:2  ~``="~ \dfrac{3}{5}$, sendo que $3:2 = \dfrac{3/5}{2/5}$ denotará a chance e $\dfrac{3}{5}$ a probabilidade.  

  
  $$OR ~=~ \frac{p}{(1-p)} \div \frac{q}{(1-q)} ~=~  \frac{p(1-q)}{q(1-q)}$$  
  - No exemplo:
  
  $$OR ~=~ \frac{3/5}{2/5} \div \frac{1/5}{4/5} ~=~ \frac{3}{2} \div {1 \over 4} ~=~ \frac{3}{2} ~.~  \frac{4}{1} =  6$$


---

##	Medidas para Testes de Diagnóstico

Considere um teste para uma determinada doença, de modo que o resultado do teste pode ser 1: *Positivo* e 0: *Negativo* e o indivíduos podem estar 1: *Doente* ou 0: *Não Doente*.

```{r dados_diag}
require(gtsummary)

dados <- tibble(Teste = c(1,1,1,1,1,0,0,0,0,0),
                Doente = c(1,0,1,0,1,0,0,0,1,0))

dados %>% tbl_cross(Teste, Doente, percent = "cell") %>%
  bold_labels()
```

As medidas a seguir são bastante utilizadas no contexto de testes de diagnósticos: 

###	Sensibilidade

$S = P(Teste = 1 ~|~ Doente = 1)$  
  * estimativa: $s = \dfrac{o_{22}}{o_{\bullet 2}}$  
  * no exemplo: $s = \dfrac{3}{4}$ 

###	Especificidade

$E = P(Teste = 0 ~|~ Doente = 0)$  
  - estimativa: $e = \dfrac{o_{11}}{o_{\bullet 1}}$  
  - no exemplo: $e = \dfrac{4}{6}$  

###	Falso Positivo

$FP = P(Teste = 1 ~|~ Doente = 0)$  
  - estimativa: $fp = \dfrac{o_{21}}{o_{\bullet 1}}$  
  - no exemplo: $fp = \dfrac{2}{6}$  

###	Falso Negativo 

$FN = P(Teste = 0 ~|~ Doente = 1)$  
  - estimativa: $fn = \dfrac{o_{12}}{o_{\bullet 2}}$  
  - no exemplo: $fn = \dfrac{1}{4}$  

###	Valor Preditivo Positivo

$VPP=P(Doente=1~|~Teste=1)$  
  - estimativa: $vpp = \dfrac{o_{22}}{o_{2 \bullet}}$  
  - no exemplo: $vpp = \dfrac{3}{5}$ 

### Valor Preditivo Negativo

$VPN = P(Doente=0~|~Teste=0)$  
  - estimativa: $vpn = \dfrac{o_{11}}{o_{1 \bullet}}$  
  - no exemplo: $vpn = \dfrac{4}{5}$

###	Acurácia

$AC = P\left[(\text{Teste}=0, \text{Doente} = 0) \cup (\text{Teste}=1, \text{Doente} = 1)\right]$
  - estimativa: $ac = \dfrac{o_{11}+o_{22}}{n}$  
  - no exemplo: $ac = \dfrac{3+4}{10} = \dfrac{7}{10}$ 

---

<!--chapter:end:Cap8-Med_duas_variáveis.Rmd-->

# Respostas dos exercícios

---

## Capítulo 3

- **Exercício 1**

```{r cap3_ex1}
vetor1 <- c(10, 9, 8, 7, 6, 5, 4, 3, 2, 1)
vetor2 <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)

soma <- vetor1 + vetor2
subtracao <- vetor1 - vetor2
multiplicacao <- vetor1 * vetor2
```

- **Exercício 2**

```{r cap3_ex2}
matriz1 <- matrix(1:4, nrow = 2, ncol = 2)
matriz2 <- matrix(5:8, nrow = 2, ncol = 2)

soma <- matriz1 + matriz2
subtracao <- matriz1 - matriz2
multiplicacao <- matriz1 %*% matriz2
```

- **Exercício 3**

```{r cap3_ex3}
alunos <- data.frame(
  Nome = c("Letícia", "Mariana", "Ana", "Otávio", "Ricardo"),
  Idade = c(17, 18, 16, 17, 19),
  Nota = c(8.5, 6.2, 4.3, 2.0, 5.5)
)

alunos$Aprovado <- alunos$Nota >= 6
print(alunos)
```


- **Exercício 4**

```{r cap3_ex4}
exponencial <- function(M, b=exp(1)) {
  lc <- dim(M) # vetor com número de linhas e colunas de M
  E <- M # inicializa a matriz E que será retornada pela função
  i <- 1 # Inicializa i que irá percorrer as linhas
  while(i<=lc[1]){
    j <- 1 # inicializa j que irá percorrer as colunas
    while(j<=lc[2]){
      E[i,j] <- b^M[i,j] # calcula os elementos da matriz E
      j <- j + 1 # atualiza j
    }
    i <- i + 1 # atualiza i
  }
  return(E)
}

# Testa a função 'exponencial'
M
exponencial(M,2)  
exponencial(M)
```

- **Exercício 5**

```{r cap3_ex5}
calcula_area <- function(base, altura) {
  return((base * altura) / 2)
}

# Testa a função 'calcula_area'
calcula_area(15, 3)
```

- **Exercício 6**

```{r cap3_ex6}
conta_pos_neg <- function(vetor) {
  pos <- sum(vetor > 0)
  neg <- sum(vetor < 0)
  return(list(positivos = pos, negativos = neg))
}

# Testa a função 'conta_pos_neg'
vetor <- c(-10, 7, 4, -8, -15, 3, -5, 7, 0, 1, -2)
resultado <- conta_pos_neg(vetor)
print(resultado)
```

---

<!--chapter:end:Cap9-gabarito.Rmd-->

# Outros Gráficos (incompleto)

---

## Gráfico de bolhas:

```{r}
x <- c(10,20,15,20,30)
y <- c( 1, 4, 5, 1, 5)
z <- c(41,22,20,15,50)
R <- c("A","A","A","A","B")
C <- c(2,2,2,3,3)

symbols(x=x,  y=y,
        circles = z, 
        inches = 0.35,
        bg=C,
        xlim=c(5,45),
        ylim=c(0,6))

text(x,y,R,cex=1.3)
```

---

## Diferentes gráficos de barras

### Barras agrupadas

```{r}
ano=c(rep(2022,12),rep(2023,12))
mes=c(rep(1:12,2))
vendas=rpois(24,15)
m <- c('Jan','Fev','Mar','Abr','Mai','Jun',
       'Jul','Ago','Set','Out','Nov','Dez')
cores=c("deeppink3","pink")

barplot(rbind(vendas[1:12],vendas[13:24]),
        beside=T,names.arg = m, ylim=c(0,25),
        col=cores,border=NA,ylab="Vendas")

legend('topright',c('2022','2023'),
       pch=15,col=cores,box.col=NA)
```



### Barras empilhadas

### Barras 100% empilhadas

---

## Gráfico de velocímetro

---

## Gráfico mosaíco 

---

## Nuvem de palavras

---

## Configurações gráficas 

### Cor de fundo
### Imagem de fundo
### Margens gráficas
### Janelas multiplas 

---

## Exercício 

<!--chapter:end:outrosgraficos.bachup.Rmd-->

# Regressão linear (incompleto)

A regressão linear modela a relação entre duas variáveis quantitativas, onde uma variável é considerada dependente e a outra é independente. O objetivo principal é estabelecer uma equação linear que descreva como a variável dependente (\(Y\)) se comporta em função da variável independente.

A equação da regressão linear simples é $Y = a + b X + \varepsilon$.

Onde:
- $Y$ é a variável resposta (dependente)
- $X$ é a variável explicativa (independente)
- $a$ é o intercepto (valor de $Y$ quando $X = 0$)
- $b$ é o coeficiente angular (indica a variação de $Y$ para cada unidade de $X$)
- $\varepsilon$é um erro aleatório.

---

Suponha que temos interesse em estudar o valor esperado do peso de uma pessoa ($Y$, em kg), com base em sua altura ($X$, em cm). Para isso, coletamos dados de várias pessoas e ajustamos um modelo de regressão linear.

```{r, graf_regrecao, echo = FALSE}
require(ggplot2)
set.seed(123) 

altura <- c(150, 152, 153, 155, 157, 159, 160, 162, 164, 165, 
            167, 169, 170, 172, 174, 176, 177, 179, 181, 183, 
            184, 186, 188, 189, 191, 193, 194, 196, 198, 199, 
            150, 151, 153, 156, 158, 161, 163, 166, 168, 171, 
            175, 178, 180, 182, 185, 187, 190, 192, 195, 197)

# Gerar pesos com mais variação aleatória
peso <- 10 + 0.5 * altura + rnorm(50, mean = 0, sd = 15)

dados <- data.frame(altura, peso)

ggplot(dados, aes(x = altura, y = peso)) +
  geom_point(color = "blue", size = 3) +  
  geom_smooth(method = "lm", color = "red", se = FALSE, size = 1.5) + 
  labs(title = "Relação entre Altura e Peso",
       x = "Altura (cm)",
       y = "Peso (kg)") +
  theme_minimal()
```

$Y$: Variável resposta (dependente)
$X$: Variável explicativa (independente)

Com isso, temos que,

$$
E[Y \mid X = x] = a + bx
$$

Agora, para conseguir estimar esse valor esperado do peso de uma pessoa, com base em sua altura, precisamos obter o valor $a$ e $b$.

---

## Estimar $a$ e $b$

Para estimar os coeficientes usamos o método dos mínimos quadrados

$$
S = \sum_{i=1}^{n} e_i^2 = \sum_{i=1}^{n} (y_i - (a + bx_i))^2 = \sum_{i=1}^{n} (y_i - a - bx_i)^2\\
$$

$$
\left\{
  \begin{array}{l}
    \frac{\partial S(a, b)}{\partial a} = 0 \\
    \frac{\partial S(a, b)}{\partial b} = 0
  \end{array}
\right.
\Longrightarrow
\left\{
  \begin{array}{l}
    \frac{\partial S(a, b)}{\partial a} = - \sum_{i=1}^{n} 2(y_i - a - b x_i) = 0 \\
    \frac{\partial S(a, b)}{\partial b} = - \sum_{i=1}^{n} x_i \cdot 2(y_i - a - b x_i) = 0
  \end{array}
\right.
$$

$$
\Longrightarrow 
- \sum_{i=1}^{n} y_i + n a + b \sum_{i=1}^{n} x_i = 0
\Longrightarrow
a = \frac{\sum_{i=1}^{n} y_i}{n} - b \frac{\sum_{i=1}^{n} x_i}{n}
$$
$$
\Longrightarrow
a = \bar{y} - b\bar{x}
$$

<!--chapter:end:reg_linear.Rmd-->

